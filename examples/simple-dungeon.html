<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Simple Dungeon</title>
	<link href="../unicodetiles/unicodetiles.css" rel="stylesheet" type="text/css" />
	<link href="style.css" rel="stylesheet" type="text/css" />
	<script type="text/javascript" src="../unicodetiles/unicodetiles.js"></script>
	<script type="text/javascript" src="../unicodetiles/input.js"></script>
	<script type="text/javascript">
		var term; // Can't be initialized yet because DOM is not ready
		var pl = { x: 3, y: 2 };
		var map = [
			"##############################",
			"##   ###############   #######",
			"##          ########      ####",
			"##   ###### ########  ### ####",
			"########### ############# ####",
			"########### ############     #",
			"########### ############     #",
			"########### ############     #",
			"###########                  #",
			"############## ###############",
			"############## #######    ####",
			"#        ##### ####### #  ####",
			"#  ####   #### ####### #######",
			"#         #### ####### #######",
			"#         #### #######      ##",
			"## ########### #######      ##",
			"## ########### ########### ###",
			"## ########### ########### ###",
			"## ########### ########### ###",
			"## #####       ########### ###",
			"## #####     # ########### ###",
			"## #####     # ########### ###",
			"## #####     # ########### ###",
			"## #####     # ########### ###",
			"## ########### ########### ###",
			"## ########### ########### ###",
			"## ###########             ###",
			"## ############# #############",
			"##               #############",
			"##############################"
		];

		function getDungeonTile(x, y) {
			var t = "";
			try { t = map[y][x]; }
			catch(err) { return new ut.Tile(t); }
			if (t === '#') return new ut.Tile('#', 100, 100, 100);
			return new ut.Tile(t);
		}

		function start() {
			window.setInterval("tick()", 150);
			term = new ut.Window(document.getElementById("game"), 41, 25);
		}

		function handleKeys() {
			var oldx = pl.x, oldy = pl.y;
			if (pressedKeys[KEY_LEFT])  pl.x--;
			if (pressedKeys[KEY_RIGHT]) pl.x++;
			if (pressedKeys[KEY_UP])    pl.y--;
			if (pressedKeys[KEY_DOWN])  pl.y++;
			if (getDungeonTile(pl.x, pl.y).getChar() === '#') { pl.x = oldx; pl.y = oldy; }
		}

		function tick() {
			// Input
			handleKeys();
			// Map
			term.proceduralFill(getDungeonTile, pl.x-term.cx, pl.y-term.cy);
			// Player character
			term.put(new ut.Tile("@", 255, 255, 255), term.cx, term.cy);
			// Render
			term.render();
		}
	</script> 
</head>

<body onload="start();"><div id="container">

	<p class="centerer">Move around with arrow keys.</p>

	<div class="centerer">
		<div id="game"></div>
	</div>

</div></body>
</html>
