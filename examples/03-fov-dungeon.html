<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Simple Dungeon</title>
	<link href="../unicodetiles/unicodetiles.css" rel="stylesheet" type="text/css" />
	<link href="style.css" rel="stylesheet" type="text/css" />
	<script type="text/javascript" src="../unicodetiles/unicodetiles.js"></script>
	<script type="text/javascript" src="../unicodetiles/input.js"></script>
	<!-- We are extending the simple-dungeon example -->
	<script type="text/javascript" src="simple-dungeon.js"></script> 
	<script type="text/javascript">
		function hasLOS(startx, starty, targetx, targety) {
			var distx = targetx - startx, disty = targety - starty;
			var maxdist = Math.max(Math.abs(distx), Math.abs(disty));
			var dx = distx / maxdist, dy = disty / maxdist;
			var xx = startx, yy = starty;
			for (var i = 0; i < maxdist; ++i) {
				if (getDungeonTile(xx,yy).getChar() === "#")
					return false;
				xx += dx; yy += dy;
			}
			return true;
		}

		function calculateFOV(x, y) {
			// Shoot a beam from the four corners of the player tile
			// to the corresponding corners of the target tile
			var d = 0.3;
			if (hasLOS(pl.x-d, pl.y-d, x-d, y-d)) return true;
			if (hasLOS(pl.x+d, pl.y-d, x+d, y-d)) return true;
			if (hasLOS(pl.x+d, pl.y+d, x+d, y+d)) return true;
			if (hasLOS(pl.x-d, pl.y+d, x-d, y+d)) return true;
			return false;
		}

		// Initializes the FOV
		function initFOV() {
			eng.setMaskFunc(calculateFOV);
		}
	</script> 
</head>

<body onload="initSimpleDungeon(); initFOV();"><div id="container">

	<p class="centerer">Move around with arrow keys.</p>

	<div class="centerer">
		<div id="game"></div>
	</div>

</div></body>
</html>
